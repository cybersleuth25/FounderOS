{% extends 'base.html' %}
{% block title %}Matching — Mentors & Investors{% endblock %}
{% block content %}
<div class="flex items-center justify-between mb-8">
  <div>
    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
      <i class="fa-solid fa-users text-amber-400"></i> Matching System
    </h1>
    <p class="text-zinc-400 text-sm mt-1">Connect with mentors, co-founders, advisors, and investors.</p>
  </div>
</div>

<!-- Filters -->
<div class="flex items-center gap-3 mb-6 flex-wrap">
  <a href="{% url 'matching_home' %}" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if not role_filter %}bg-sky-500 text-white{% else %}border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800{% endif %}">
    All
  </a>
  {% for role, label in role_choices %}
  <a href="?role={{ role }}" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if role_filter == role %}bg-sky-500 text-white{% else %}border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800{% endif %}">
    {{ label }}
  </a>
  {% empty %}
  <a href="?role=mentor" class="px-4 py-2 rounded-lg text-sm font-medium border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 {% if role_filter == 'mentor' %}bg-sky-500 text-white border-sky-500{% endif %}">Mentors</a>
  <a href="?role=investor" class="px-4 py-2 rounded-lg text-sm font-medium border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 {% if role_filter == 'investor' %}bg-sky-500 text-white border-sky-500{% endif %}">Investors</a>
  <a href="?role=cofounder" class="px-4 py-2 rounded-lg text-sm font-medium border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 {% if role_filter == 'cofounder' %}bg-sky-500 text-white border-sky-500{% endif %}">Co-founders</a>
  <a href="?role=advisor" class="px-4 py-2 rounded-lg text-sm font-medium border border-zinc-700 text-zinc-400 hover:text-white hover:bg-zinc-800 {% if role_filter == 'advisor' %}bg-sky-500 text-white border-sky-500{% endif %}">Advisors</a>
  {% endfor %}
</div>

{% if profiles %}
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
  {% for p in profiles %}
  <div class="card hover:border-amber-500/20 transition-colors">
    <div class="flex items-start gap-3 mb-3">
      <div class="w-11 h-11 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center text-white font-bold text-lg flex-shrink-0">
        {{ p.name|first|upper }}
      </div>
      <div class="flex-1 min-w-0">
        <div class="text-white font-semibold">{{ p.name }}</div>
        <div class="text-zinc-400 text-xs">
          {% if p.role == 'mentor' %}<span class="text-sky-400">Mentor</span>
          {% elif p.role == 'investor' %}<span class="text-emerald-400">Investor</span>
          {% elif p.role == 'cofounder' %}<span class="text-purple-400">Co-founder</span>
          {% else %}<span class="text-amber-400">Advisor</span>{% endif %}
          {% if p.location %} · {{ p.location }}{% endif %}
        </div>
      </div>
    </div>
    {% if p.bio %}
    <p class="text-zinc-400 text-sm mb-3 line-clamp-2">{{ p.bio }}</p>
    {% endif %}
    {% if p.industry %}
    <div class="text-xs text-zinc-500 mb-3"><i class="fa-solid fa-building mr-1"></i>{{ p.industry }}</div>
    {% endif %}
    {% if p.skills %}
    <div class="flex flex-wrap gap-1.5 mb-4">
      {% for skill in p.skills_list %}
        <span class="bg-zinc-900 border border-zinc-700 text-zinc-400 text-xs px-2 py-0.5 rounded">{{ skill }}</span>
      {% endfor %}
    </div>
    {% endif %}
    {% if p in my_requests_profiles %}
      <div class="badge-green w-full justify-center py-1.5 text-sm">
        <i class="fa-solid fa-check"></i> Request Sent
      </div>
    {% else %}
      <button onclick="document.getElementById('modal-{{ p.pk }}').classList.remove('hidden')"
        class="btn-secondary w-full justify-center text-xs">
        <i class="fa-solid fa-paper-plane"></i> Connect
      </button>
    {% endif %}
  </div>

  <!-- Connect Modal -->
  <div id="modal-{{ p.pk }}" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center px-4">
    <div class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 w-full max-w-sm">
      <h3 class="text-white font-semibold mb-1">Connect with {{ p.name }}</h3>
      <p class="text-zinc-400 text-sm mb-4">Send a connection request with a message.</p>
      <form method="post" action="{% url 'match_connect' p.pk %}">
        {% csrf_token %}
        <textarea name="message" rows="3" class="form-input resize-none mb-4"
          placeholder="Hi! I'm building a startup in [your industry] and I'd love your guidance on..."></textarea>
        <div class="flex gap-3">
          <button type="submit" class="btn-primary flex-1 justify-center">Send Request</button>
          <button type="button" onclick="document.getElementById('modal-{{ p.pk }}').classList.add('hidden')"
            class="btn-secondary justify-center px-4">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card text-center py-16">
  <i class="fa-solid fa-users text-zinc-700 text-5xl mb-4"></i>
  <h3 class="text-zinc-400 font-medium mb-2">No profiles available yet</h3>
  <p class="text-zinc-600 text-sm">Profiles are added by the FounderOS admin. Check back soon.</p>
  <a href="/admin/" class="btn-secondary mt-4 text-xs">Go to Admin Panel</a>
</div>
{% endif %}
{% endblock %}
